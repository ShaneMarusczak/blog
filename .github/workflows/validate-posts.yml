name: Validate posts.json

on:
  push:
    branches: [main]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check posts.json matches posts/ directory
        run: |
          html_count=$(find posts -maxdepth 1 -name '*.html' | wc -l | tr -d ' ')
          json_count=$(python3 -c "import json; print(len(json.load(open('posts.json'))))")

          echo "HTML files in posts/: $html_count"
          echo "Entries in posts.json: $json_count"

          if [ "$html_count" != "$json_count" ]; then
            echo ""
            echo "MISMATCH: posts.json has $json_count entries but posts/ has $html_count HTML files."
            echo "Update posts.json before pushing."
            exit 1
          fi

          echo "OK â€” counts match."
